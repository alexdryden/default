<?php
$translate = $this->plugin('translate');
$prevText = $translate('Prev: ');
$nextText = $translate('Next: ');
$default_thumb = $this->assetUrl('img/BlockI-Logo-Full-Color-RGB.png');
function getThumbnail($page, $default){
    //default thumbnail if the page has no media
    $url = $default;
    $alt = 'Default image for next page when no specific media was found for the page';

    //get the first media attachment on the target page
    foreach($page->blocks() as $block){
        if (get_class($block) === 'Omeka\Api\Representation\SitePageBlockRepresentation'){
            if ($block->attachments()){
                $url = $block->attachments()[0]->media()->thumbnailUrl("square");

                //TODO what should we put if they haven't actually added alt text?
                $alt = $block->attachments()[0]->media()->primaryMedia()->jsonSerialize()['o-module-alt-text:alt-text'];
                break;
            }
        }
    }
    return ['url' => $url, 'alt' => $alt];
}
?>


<?php if ($prevPage || $nextPage): ?>

    <div class="site-page-pagination">

        <div class="prev-page">
            <?php if ($prevPage){
                $prevTitle = $prevPage->title();
                $prevPageThumb = getThumbnail($prevPage, $default_thumb);
                echo $this->hyperlink($prevText . $prevTitle, $prevPage->siteUrl());
                echo '<img src="' . $prevPageThumb['url'] . '" alt="'. $prevPageThumb['alt'].'">';
            }?>
        </div>

        <div class="next-page">
            <?php  if ($nextPage){
                $nextTitle = $nextPage->title();
                $nextPageThumb = getThumbnail($nextPage, $default_thumb);
                echo $this->hyperlink($nextText . $nextTitle, $nextPage->siteUrl());
                echo '<img src="' . $nextPageThumb['url'] . '" alt="' .$nextPageThumb['alt'].'">';
            }?>
        </div>
    </div>
<?php endif; ?>